DOCKER_GID_KEY = 'DOCKER_GID'
GITLAB_URL_KEY = 'GITLAB_URL'
GITLAB_USER_KEY = 'GITLAB_USER'
GITLAB_PASSWORD_KEY = 'GITLAB_PASSWORD'
GITLAB_GROUP_KEY = 'GITLAB_GROUP'
GITLAB_API_KEY_KEY = 'GITLAB_API_KEY'
GITLAB_CLIENT_ID_KEY = 'GITLAB_CLIENT_ID'
GITLAB_CLIENT_SECRET_KEY = 'GITLAB_CLIENT_SECRET'
GITLAB_SCRIPTS_DIR_KEY = 'GITLAB_SCRIPTS_DIR'
GITLAB_TEMPLATES_DIR_KEY = 'GITLAB_TEMPLATES_DIR'
JENKINS_ADMIN_PASSWORD_KEY = 'JENKINS_ADMIN_PASSWORD'
JENKINS_ADMIN_USER_KEY = 'JENKINS_ADMIN_USER'
JENKINS_FOLDER_KEY = 'JENKINS_FOLDER'
POSTGRES_EXTENSIONS_KEY = 'POSTGRES_EXTENSIONS'
POSTGRES_DB_KEY = 'POSTGRES_DB'
POSTGRES_USER_KEY = 'POSTGRES_USER'
POSTGRES_PASSWORD_KEY = 'POSTGRES_PASSWORD'
POSTGRES_HOST_AUTH_METHOD_KEY = 'POSTGRES_HOST_AUTH_METHOD'

DOCKER_GID_VALUE = local(command='getent group docker | cut -d: -f3')
GITLAB_URL_VALUE = 'http://gitlab.local:8090'
GITLAB_USER_VALUE = 'root'
GITLAB_PASSWORD_VALUE = '-rob123-'
GITLAB_GROUP_VALUE = 'backstage-demo'
GITLAB_API_KEY_VALUE = 'glpat-zQ-yQ8VyW37oRSbEnWAx'
GITLAB_CLIENT_ID_VALUE = 'd3ea15baea5a9d72ed6a5fa2e42c71140a634bc374b0b0aaa01066a87e62ec62'
GITLAB_CLIENT_SECRET_VALUE = 'gloas-b1f8c16b11c2a90737b678ec970e0f0247aee65ae886e7dce89c65ae29a6bf67'
GITLAB_SCRIPTS_DIR_VALUE = '/scripts'
GITLAB_TEMPLATES_DIR_VALUE = '/scripts/templates'
JENKINS_ADMIN_PASSWORD_VALUE = 'backstage'
JENKINS_ADMIN_USER_VALUE = 'backstage'
JENKINS_FOLDER_VALUE = 'backstage-demo'
POSTGRES_EXTENSIONS_VALUE = 'pg_trgm,btree_gist'
POSTGRES_DB_VALUE = 'gitlabhq_production'
POSTGRES_USER_VALUE = 'gitlab'
POSTGRES_PASSWORD_VALUE = 'password'
POSTGRES_HOST_AUTH_METHOD_VALUE = 'trust'

BUILD_ARGS = {
    DOCKER_GID_KEY: DOCKER_GID_VALUE,
    GITLAB_URL_KEY: GITLAB_URL_VALUE,
    GITLAB_USER_KEY: GITLAB_USER_VALUE,
    GITLAB_PASSWORD_KEY: GITLAB_PASSWORD_VALUE,
    GITLAB_GROUP_KEY: GITLAB_GROUP_VALUE,
    GITLAB_API_KEY_KEY: GITLAB_API_KEY_VALUE,
    GITLAB_CLIENT_ID_KEY: GITLAB_CLIENT_ID_VALUE,
    GITLAB_CLIENT_SECRET_KEY: GITLAB_CLIENT_SECRET_VALUE,
    GITLAB_SCRIPTS_DIR_KEY: GITLAB_SCRIPTS_DIR_VALUE,
    GITLAB_TEMPLATES_DIR_KEY: GITLAB_TEMPLATES_DIR_VALUE,
    JENKINS_ADMIN_PASSWORD_KEY: JENKINS_ADMIN_PASSWORD_VALUE,
    JENKINS_ADMIN_USER_KEY: JENKINS_ADMIN_USER_VALUE,
    JENKINS_FOLDER_KEY: JENKINS_FOLDER_VALUE,
    POSTGRES_EXTENSIONS_KEY: POSTGRES_EXTENSIONS_VALUE,
    POSTGRES_DB_KEY: POSTGRES_DB_VALUE,
    POSTGRES_USER_KEY: POSTGRES_USER_VALUE,
    POSTGRES_PASSWORD_KEY: POSTGRES_PASSWORD_VALUE,
    POSTGRES_HOST_AUTH_METHOD_KEY: POSTGRES_HOST_AUTH_METHOD_VALUE
}

os.putenv(DOCKER_GID_KEY, DOCKER_GID_VALUE)
os.putenv(GITLAB_URL_KEY, GITLAB_URL_VALUE)
os.putenv(GITLAB_USER_KEY, GITLAB_USER_VALUE)
os.putenv(GITLAB_PASSWORD_KEY, GITLAB_PASSWORD_VALUE)
os.putenv(GITLAB_GROUP_KEY, GITLAB_GROUP_VALUE)
os.putenv(GITLAB_API_KEY_KEY, GITLAB_API_KEY_VALUE)
os.putenv(GITLAB_CLIENT_ID_KEY, GITLAB_CLIENT_ID_VALUE)
os.putenv(GITLAB_CLIENT_SECRET_KEY, GITLAB_CLIENT_SECRET_VALUE)
os.putenv(GITLAB_SCRIPTS_DIR_KEY, GITLAB_SCRIPTS_DIR_VALUE)
os.putenv(GITLAB_TEMPLATES_DIR_KEY, GITLAB_TEMPLATES_DIR_VALUE)
os.putenv(JENKINS_ADMIN_PASSWORD_KEY, JENKINS_ADMIN_PASSWORD_VALUE)
os.putenv(JENKINS_ADMIN_USER_KEY, JENKINS_ADMIN_USER_VALUE)
os.putenv(JENKINS_FOLDER_KEY, JENKINS_FOLDER_VALUE)
os.putenv(POSTGRES_EXTENSIONS_KEY, POSTGRES_EXTENSIONS_VALUE)
os.putenv(POSTGRES_DB_KEY, POSTGRES_DB_VALUE)
os.putenv(POSTGRES_USER_KEY, POSTGRES_USER_VALUE)
os.putenv(POSTGRES_PASSWORD_KEY, POSTGRES_PASSWORD_VALUE)
os.putenv(POSTGRES_HOST_AUTH_METHOD_KEY, POSTGRES_HOST_AUTH_METHOD_VALUE)

docker_build(
    ref = 'gitlab-image',
    context = './gitlab',
    build_args = BUILD_ARGS,
)
docker_build(
    ref ='jenkins-image',
    context = './jenkins',
    build_args = BUILD_ARGS
)

docker_compose( configPaths = './docker-compose.yaml')

dc_resource(name = 'gitlab', labels = ['Services'])
dc_resource(name = 'jenkins', labels = ['Services'])
dc_resource(name = 'postgres', labels = ['Services'])
dc_resource(name = 'redis', labels = ['Services'])
