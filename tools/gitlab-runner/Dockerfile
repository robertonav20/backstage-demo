FROM gitlab/gitlab-runner:alpine3.19

RUN apk add --no-cache jq

ARG GITLAB_URL
ARG GITLAB_API_KEY
ARG GITLAB_SCRIPTS_DIR="/scripts"

ENV GITLAB_URL=$GITLAB_URL
ENV GITLAB_API_KEY=$GITLAB_API_KEY
ENV GITLAB_SCRIPTS_DIR=$GITLAB_SCRIPTS_DIR

RUN mkdir -p "$GITLAB_SCRIPTS_DIR"

COPY ./gitlab-runner-startup.sh $GITLAB_SCRIPTS_DIR

RUN chmod +xr "$GITLAB_SCRIPTS_DIR"/gitlab-runner-startup.sh